action transitive a_take named "pick up", "take", "grab";
action transitive a_drop named "drop";
action modal a_goto named "go to", "goto" uses modes "red room", "yellow room", "weird room", "white room";
action general a_quit named "quit";
action general a_lookaround;

room archetype r_colored_room
{
	function getColorType()
	{
		return "weird";
	}

	onAction(a_lookaround)
	{
		Textln("This room has a "+getColorType()+" color.");
	}
}

room r_red_room : r_colored_room
{
	override function getColorType()
	{
		return "red";
	}
}

room r_yellow_room : r_colored_room
{
	override function getColorType()
	{
		return "yellow";
	}
}

room r_white_room : r_colored_room
{
	override function getColorType()
	{
		return "white";
	}
}

room r_weird_room
{
	onAction(a_lookaround)
	{
		Textln("You cannot grasp the form of the room.");
	}
}

object o_ball named "ball";

player p_main
{
	onModalAction(a_goto, "red room")
	{
		SetRoom(player, r_red_room);
	}
	
	onModalAction(a_goto, "yellow room")
	{
		SetRoom(player, r_yellow_room);
	}
	
	onModalAction(a_goto, "white room")
	{
		SetRoom(player, r_white_room);
	}
	
	onModalAction(a_goto, "weird room")
	{
		SetRoom(player, r_weird_room);
	}
	
}

extend object o_ball
{
	onAction(a_drop)
	{
		if (!HasObject(player, o_ball))
			Textln("I don't have the ball.");
		else
		{
			GiveObject(room, o_ball);
			Textln("I dropped the ball.");
		}
	}
	
	onAction(a_take)
	{
		if (HasObject(player, this))
			Textln("I already have this.");
		else
		{
			GiveObject(player, this);
			Textln("Taken.");
		}
	}

	onElementBrowse(r_red_room)
	{
		Textln("A ball is here on the ground. It looks red.");
	}

	onElementBrowse(r_yellow_room)
	{
		Textln("A ball is here on the ground. It looks yellow.");
	}
	
	// archetype room.
	onElementBrowse(r_colored_room)
	{
		Textln("A ball is here on the ground. It is a non-specific color.");
	}
	
	onRoomBrowse()
	{
		Textln("A ball is here.");
	}
	
	onPlayerBrowse()
	{
		Textln("I have a ball.");
	}
	
	onWorldBrowse()
	{
		Textln("A ball is omnipresent.");
	}
	
}

world
{
	init()
	{
		GiveObject(world, o_ball);
		SetPlayer(p_main);
		SetRoom(p_main, r_red_room);
	}

	function doTurn()
	{
		Browse(room);
		Browse(player);
		Browse(world);
		queue a_lookaround;
	}
	
	start()
	{
		Textln("Move between rooms with \"go to\" and the name of a room (\"red\", \"yellow\", \"weird\", \"white\")");
		Textln("Pick up things with \"take\" or \"pick up\".");
		doTurn();
	}
	
	onAction(a_quit)
	{
		quit;
	}
	
	afterSuccessfulCommand()
	{
		doTurn();
	}
	
}
